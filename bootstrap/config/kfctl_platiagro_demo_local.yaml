# This is the config to install Kubeflow on an existing k8s cluster.
# If the cluster already has istio, comment out the istio install part below.

apiVersion: kfdef.apps.kubeflow.org/v1alpha1
kind: KfDef
metadata:
  name: kubeflow_app
  namespace: kubeflow
spec:
  repos:
    - name: manifests
      uri: file:///home/cpqd/manifests
    - name: kubeflow
      uri: file:///home/cpqd/kubeflow
  applications:
    # Istio install. If not needed, comment out istio-crds and istio-install.
    - kustomizeConfig:
        parameters:
          - name: namespace
            value: istio-system
        repoRef:
          name: manifests
          path: istio/istio-crds
      name: istio-crds
    - kustomizeConfig:
        parameters:
          - name: namespace
            value: istio-system
        repoRef:
          name: manifests
          path: istio/istio-install
      name: istio-install
    # This component is the istio resources for Kubeflow (e.g. gateway), not about installing istio.
    - kustomizeConfig:
        parameters:
          - name: clusterRbacConfig
            value: "OFF"
        repoRef:
          name: manifests
          path: istio/istio
      name: istio
    - kustomizeConfig:
        repoRef:
          name: manifests
          path: application/application-crds
      name: application-crds
    - kustomizeConfig:
        overlays:
          - application
        repoRef:
          name: manifests
          path: application/application
      name: application
    - kustomizeConfig:
        repoRef:
          name: manifests
          path: metacontroller
      name: metacontroller
    - kustomizeConfig:
        overlays:
          - istio
        repoRef:
          name: manifests
          path: argo
      name: argo
    #- kustomizeConfig:
    #    overlays:
    #      - istio
    #    repoRef:
    #      name: manifests
    #      path: common/centraldashboard
    #  name: centraldashboard
    - kustomizeConfig:
        overlays:
          - istio
        repoRef:
          name: manifests
          path: platiagro/foragri-frutas
      name: foragri-frutas
    - kustomizeConfig:
        overlays:
          - istio
        repoRef:
          name: manifests
          path: platiagro/foragri-falha
      name: foragri-falha
    - kustomizeConfig:
        overlays:
          - istio
        repoRef:
          name: manifests
          path: platiagro/dataset-store
      name: dataset-store
    - kustomizeConfig:
        overlays:
          - istio
        repoRef:
          name: manifests
          path: platiagro/projects
      name: projects
    - kustomizeConfig:
        overlays:
          - istio
        repoRef:
          name: manifests
          path: platiagro/web-ui
      name: web-ui
    - kustomizeConfig:
        repoRef:
          name: manifests
          path: admission-webhook/bootstrap
      name: bootstrap
    - kustomizeConfig:
        repoRef:
          name: manifests
          path: admission-webhook/webhook
      name: webhook
    - kustomizeConfig:
        overlays:
          - istio
          - application
        repoRef:
          name: manifests
          path: jupyter/jupyter-web-app
      name: jupyter-web-app
    - kustomizeConfig:
        overlays:
          - istio
          - application
        repoRef:
          name: manifests
          path: jupyter/notebook-controller
      name: notebook-controller
    - kustomizeConfig:
        repoRef:
          name: manifests
          path: pipeline/api-service
      name: api-service
    - kustomizeConfig:
        overlays:
          - istio
        parameters:
          - name: minioPvcName
            value: minio-pv-claim
        repoRef:
          name: manifests
          path: pipeline/minio
      name: minio
    - kustomizeConfig:
        parameters:
          - name: mysqlPvcName
            value: mysql-pv-claim
        repoRef:
          name: manifests
          path: pipeline/mysql
      name: mysql
    - kustomizeConfig:
        repoRef:
          name: manifests
          path: pipeline/persistent-agent
      name: persistent-agent
    - kustomizeConfig:
        repoRef:
          name: manifests
          path: pipeline/pipelines-runner
      name: pipelines-runner
    - kustomizeConfig:
        overlays:
          - istio
        repoRef:
          name: manifests
          path: pipeline/pipelines-ui
      name: pipelines-ui
    - kustomizeConfig:
        repoRef:
          name: manifests
          path: pipeline/pipelines-viewer
      name: pipelines-viewer
    - kustomizeConfig:
        repoRef:
          name: manifests
          path: pipeline/scheduledworkflow
      name: scheduledworkflow
    - kustomizeConfig:
        overlays:
          - istio
        parameters:
          - initRequired: true
            name: admin
            value: johnDoe@acme.com
        repoRef:
          name: manifests
          path: profiles
      name: profiles
    - kustomizeConfig:
        overlays:
          - application
        repoRef:
          name: manifests
          path: seldon/seldon-core-operator
      name: seldon-core-operator   
  enableApplications: true
  packageManager: kustomize
  skipInitProject: true
  useBasicAuth: false
  useIstio: true
  version: SET_VERSION
